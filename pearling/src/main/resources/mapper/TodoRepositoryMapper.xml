<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pearling.web.repository.TodoRepository">
   <select id="findAll" resultType="Todo">
		select t.*, m.profile_image
		from to_do t
		inner join member m on t.member_id = m.id
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="query != null">
				and	t.content like '%${query}%'
			</if>			
		</trim>
	</select>
	<select id="findById" resultType="Todo">
		select * 
		from to_do
		WHERE id = #{id};
	</select>
	<select id="findByUserId" resultType="Todo">
		select * 
		from to_do
		WHERE member_id = #{memberId};
	</select>
	<select id="findByDate" resultType="Todo">
		SELECT *
		FROM to_do
		WHERE member_id = #{memberId} AND date = '${date.toString()}'
		ORDER BY CASE WHEN statement = 'Y' THEN 0 ELSE 1 END;
	</select>
	<select id="findByCurDate" resultType="Todo">
		SELECT m.id, m.nickname, t.content
		FROM follow f
		JOIN member m ON f.following_id = m.id
		JOIN to_do t ON m.id = t.member_id
		WHERE f.follower_id = 3
			AND DATE(t.date) = CURDATE()
			AND t.member_id = m.id;
	</select>
	<update id="update" parameterType="Integer">
	update to_do
	<set> 
		<if test="statement != null">statement = #{statement}</if>
	</set>
	where id = #{id};
	</update>
	<insert id="save">
		insert into 
		to_do(date, statement, member_id, content)
		VALUES(#{date}, #{statement}, #{memberId}, #{content})
	</insert>
	<delete id="delete">
		delete from to_do where id=#{id}
	</delete>


</mapper>